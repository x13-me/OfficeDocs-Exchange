---
title: Troubleshooting UM Health Set
TOCTitle: Troubleshooting UM Health Set
ms:assetid: db947791-63ce-45dd-8634-1dfa5f55e2c2
ms:mtpsurl: https://technet.microsoft.com/en-us/library/ms.exch.scom.um(v=EXCHG.150)
ms:contentKeyID: 49720901
ms.date: 10/08/2015
mtps_version: v=EXCHG.150
---

<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="http://msdn.microsoft.com/en-us/">

<div data-asp="http://msdn2.microsoft.com/asp">

# Troubleshooting UM Health Set

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**Applies to:** Exchange Server 2013, Project Server 2013_

_**Topic Last Modified:** 2015-03-09_

The Unified Messaging (UM) health set monitors the overall health of the UM service in your organization.

If you receive an alert that specifies that UM is unhealthy, this indicates an issue that may prevent users from using the UM service in your organization. The UM health set is closely related to the following health sets:

[Troubleshooting UM.CallRouter Health Set](troubleshooting-um-callrouter-health-set.md)

[Troubleshooting UM.Protocol Health Set](troubleshooting-um-protocol-health-set.md)

<span id="EXP"></span>

<div>

## Explanation

The UM service is monitored by using the following probes and monitors.


<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th>Probe</th>
<th>Health Set</th>
<th>Dependencies</th>
<th>Associated Monitors</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>UMSelfTestProbe</p></td>
<td><p>UM.Protocol</p></td>
<td><p>Active Directory Domain Services (AD DS)</p></td>
<td><p>UMSelfTestMonitor</p></td>
</tr>
<tr class="even">
<td><p>UMCallRouterTestProbe</p></td>
<td><p>UM.CallRouter</p></td>
<td><p>Active Directory Domain Services (AD DS)</p></td>
<td><p>UMCallRouterTestMonitor</p></td>
</tr>
</tbody>
</table>


For more information about probes and monitors, see [Server health and performance](https://technet.microsoft.com/en-us/library/jj150551\(v=exchg.150\)).

</div>

<div>

## User Action

It's possible that the service recovered after it issued the alert. Therefore, when you receive an alert that specifies that the health set is unhealthy, first verify that the issue still exists. If the issue does exist, perform the appropriate recovery actions outlined in the following sections.

<span id="verify"></span>

<div>

## Verifying the issue still exists

1.  Identify the health set name and the server name in the alert.

2.  The message details provide information about the exact cause of the alert. In most cases, the message details provide sufficient troubleshooting information to identify the root cause. If the message details are not clear, do the following:
    
    1.  Open the Exchange Management Shell, and then run the following command to retrieve the details of the health set that issued the alert:
        
            Get-ServerHealth <server name> | ?{$_.HealthSetName -eq "<health set name>"}
        
        For example, to retrieve the UM.Protocol health set details about server1.contoso.com, run the following command:
        
            Get-ServerHealth server1.contoso.com | ?{$_.HealthSetName -eq "UM.Protocol"}
    
    2.  Review the command output to determine which monitor reported the error. The **AlertValue** value for the monitor that issued the alert will be `Unhealthy`.
    
    3.  Rerun the associated probe for the monitor that is in an unhealthy state. Refer to the table in the Explanation section to find the associated probe. To do this, run the following command:
        
            Invoke-MonitoringProbe <health set name>\<probe name> -Server <server name> | Format-List
        
        For example, assume that the failing monitor is **UMSelfTestMonitor**. The probe associated with that monitor is **UMSelfTestProbe**. To run that probe on server1.contoso.com, run the following command:
        
            Invoke-MonitoringProbe UM.Protocol\UMSelfTestMonitor -Server server1.contoso.com | Format-List
    
    4.  In the command output, review the **Result** value of the probe. If the value is **Succeeded**, the issue was a transient error, and it no longer exists. Otherwise, refer to the recovery steps outlined in the following sections.

</div>

<span id="TestMonitors"></span>

<div>

## Troubleshooting steps

When you receive an alert from a health set, the email message contains the following information:

  - Name of the server that sent the alert

  - Time and date when the alert occurred

  - Authentication mechanism used, and credential information

  - Full exception trace of the last error, including diagnostic data and specific HTTP header information
    
    **Note**  You can use the information in the full exception trace to help troubleshoot the issue. The exception generated by the probe contains a Failure Reason that describes why the probe failed.

**Sip Options to UM Service have failed**

Determine whether the UM service is disabled. If the UM service is not started or disabled, restart the UM service.

**More than {0}% of Inbound Calls were Rejected by the UM Service Over the Last Hour**

Review the event logs on the Client Access server (CAS) to determine whether the UM objects, such as **umipgateway** and **umhuntgroup**, are configured correctly.

If the event logs do not contain enough information, you may have to enable UM event logs at the Expert level, and then review the UM trace log files.

**More than {0}% of Inbound Calls were Rejected by the UM Worker Process Over the Last Hour**

Review the event logs on the CAS to determine whether the UM objects, such as the **umipgateway** and **umhuntgroup** objects, are configured correctly.

If the event logs do not contain enough information, you may have to enable UM event logs at the Expert level, and then review the UM trace log files.

**Less than {0}% of Messages were Successfully Processed Over the Last Hour**

Review the event logs on the CAS to determine whether the UM objects, such as the **umipgateway** and **umhuntgroup** objects, are configured correctly.

If the event logs do not contain enough information, you may have to enable UM event logs at the Expert level, and then review the UM trace log files.

**The Microsoft Exchange Unified Messaging service rejected a call because the UM pipeline is full**

Review the event logs on the CAS to determine whether the UM objects, such as the **umipgateway** and **umhuntgroup** objects, are configured correctly.

If the event logs do not contain enough information, you may have to enable UM event logs at the Expert level, and then review the UM trace log files.

**The A/V Edge service is misconfigured or is not running**

1.  Review the event logs on Mailbox server to try to determine why calls from the Lync server are failing. Then, do the following:
    
      - Make sure that the Lync pool that is selected by the UM service is operational.
    
      - To use a specific Lync server, run the following command:
        
            Set-UMServer ExchangeUMServer -SIPAccessService <ServerName>

**The UM server was unable to acquire credentials successfully with the Communications Server A/V Edge service**

Review the event logs to investigate which Lync pool is selected, and to verify that the selected Lync pool is operational.

**The Communications Server Audio/Video Edge was unable to open a port or allocate resources while attempting to establish a session**

Review the event logs to investigate which Lync pool is selected, and to verify that the selected Lync pool is operational.

**The Microsoft Exchange Unified Messaging service certificate is nearing its expiration date**

Renew the UM service certificate on the Mailbox server.

**Additional troubleshooting steps:**

1.  Start IIS Manager, and connect to the server that’s reporting the issue to determine whether the **MSExchangeServicesAppPool** application pool is running.

2.  In IIS Manager, click **Application Pools**, and then recycle the **MSExchangeServicesAppPool** application pool. To do this, run the following command from the Exchange Management Shell:
    
        %SystemRoot%\System32\inetsrv\Appcmd recycle MSExchangeServicesAppPool

3.  Rerun the associated probe as shown in step 2c in the Verifying the issue still exists section.

4.  If the issue still exists, recycle the IIS service by using the IISReset utility or by running the following command:
    
        Iisreset /noforce

5.  Rerun the associated probe as shown in step 2c in the Verifying the issue still exists section.

6.  If the issue still exists, restart the server.

7.  After the server restarts, rerun the associated probe as shown in step 2c in the Verifying the issue still exists section.

8.  If the probe continues to fail, you may need assistance to resolve this issue. Contact a Microsoft Support professional to resolve this issue. To contact a Microsoft Support professional, visit the [Exchange Server Solutions Center](http://go.microsoft.com/fwlink/p/?linkid=180809). In the navigation pane, click **Support options and resources** and use one of the options listed under **Get technical support** to contact a Microsoft Support professional. Because your organization may have a specific procedure for directly contacting Microsoft Product Support Services, be sure to review your organization's guidelines first.

</div>

</div>

<div>

## For More Information

[What's new in Exchange 2013](https://technet.microsoft.com/en-us/library/jj150540\(v=exchg.150\))

[Exchange 2013 cmdlets](https://technet.microsoft.com/en-us/library/bb124413\(v=exchg.150\))

</div>

</div>

<span> </span>

</div>

</div>

</div>

